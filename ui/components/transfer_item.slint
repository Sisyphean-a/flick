import { Button, ProgressIndicator } from "std-widgets.slint";
import { Style } from "../theme/style.slint";

export struct TransferEntry {
    task_id: int,
    file_name: string,
    direction: string,
    progress: float,
    status: string,
    error_msg: string,
    speed: string,
    eta: string,
}

export component TransferItem inherits Rectangle {
    in property <TransferEntry> entry;
    callback retry(int);
    height: 36px;
    border-radius: 3px;
    background: touch.has-hover ? Style.bg-hover : transparent;

    touch := TouchArea {}

    HorizontalLayout {
        padding-left: 8px;
        padding-right: 8px;
        spacing: 8px;

        Text {
            text: entry.direction;
            width: 20px;
            vertical-alignment: center;
            font-size: 14px;
        }

        Text {
            text: entry.file_name;
            vertical-alignment: center;
            overflow: elide;
            horizontal-stretch: 1;
        }

        Rectangle {
            width: 80px;
            ProgressIndicator {
                progress: entry.progress;
                height: 6px;
            }
        }

        Text {
            text: entry.status == "done" ? "已完成"
                : entry.status == "failed" ? "失败"
                : entry.status == "progress"
                    ? Math.round(entry.progress * 100) + "%"
                    : "等待";
            width: 45px;
            vertical-alignment: center;
            horizontal-alignment: center;
            font-size: 12px;
            color: entry.status == "failed" ? Style.danger : Style.text-secondary;
        }

        if entry.status == "progress" && entry.speed != "": Text {
            text: entry.speed;
            width: 65px;
            vertical-alignment: center;
            horizontal-alignment: center;
            font-size: 11px;
            color: Style.text-muted;
        }

        if entry.status == "progress" && entry.eta != "": Text {
            text: entry.eta;
            width: 55px;
            vertical-alignment: center;
            horizontal-alignment: center;
            font-size: 11px;
            color: Style.text-muted;
        }

        if entry.status == "failed": Button {
            text: "重试";
            width: 40px;
            clicked => {
                root.retry(root.entry.task_id);
            }
        }
    }
}
