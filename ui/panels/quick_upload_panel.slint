import { Button, ComboBox, LineEdit, ProgressIndicator, VerticalBox, HorizontalBox, GroupBox } from "std-widgets.slint";

export component QuickUploadPanel inherits Rectangle {
    in property <string> file-path: "未选择文件";
    in property <[string]> servers: [];
    in property <string> target-dir: "/tmp";
    in property <bool> is-uploading: false;
    in property <float> progress: 0.0;
    in property <string> status-log: "";

    callback pick-file();
    callback server-selected(int);
    callback start-upload(int);

    VerticalBox {
        padding: 20px;
        spacing: 15px;

        Text {
            text: "Flick ⚡ 快速上传";
            font-size: 24px;
            font-weight: 700;
        }

        GroupBox {
            title: "文件";
            HorizontalBox {
                spacing: 8px;
                Text {
                    text: root.file-path;
                    vertical-alignment: center;
                    horizontal-stretch: 1;
                    overflow: elide;
                }
                Button {
                    text: "选择文件";
                    width: 80px;
                    enabled: !root.is-uploading;
                    clicked => { root.pick-file(); }
                }
            }
        }

        GroupBox {
            title: "服务器";
            combo := ComboBox {
                model: root.servers;
                current-index: 0;
                enabled: !root.is-uploading;
                selected(val) => {
                    root.server-selected(self.current-index);
                }
            }
        }

        GroupBox {
            title: "目标目录";
            target-input := LineEdit {
                text: root.target-dir;
                enabled: !root.is-uploading;
            }
        }

        HorizontalBox {
            alignment: center;
            Button {
                text: root.is-uploading ? "上传中..." : "开始上传";
                width: 120px;
                enabled: !root.is-uploading;
                clicked => {
                    root.start-upload(combo.current-index);
                }
            }
        }

        if root.is-uploading: ProgressIndicator {
            progress: root.progress;
            height: 20px;
        }

        if root.status-log != "": Rectangle {
            background: #f5f5f5;
            border-radius: 4px;
            height: 60px;
            Text {
                text: root.status-log;
                wrap: word-wrap;
                x: 8px;
                y: 8px;
            }
        }
    }
}
