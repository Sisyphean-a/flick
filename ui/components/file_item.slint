export struct FileEntry {
    name: string,
    is_dir: bool,
    size: string,
    modified: string,
    selected: bool,
}

import { Style } from "../theme/style.slint";

export component FileListHeader inherits Rectangle {
    in property <string> sort-field: "name";
    in property <bool> sort-ascending: true;
    callback sort-changed(string);
    height: 26px;
    background: Style.bg-header;
    border-width: 0px;
    border-color: Style.border-color;
    HorizontalLayout {
        padding-left: 8px;
        padding-right: 8px;
        spacing: 8px;
        Rectangle {
            width: 20px;
        }

        name-touch := TouchArea {
            horizontal-stretch: 1;
            clicked => {
                root.sort-changed("name");
            }
            Text {
                text: root.sort-field == "name" ? (root.sort-ascending ? "文件名 ▲" : "文件名 ▼") : "文件名";
                vertical-alignment: center;
                font-size: 12px;
                font-weight: root.sort-field == "name" ? 700 : 400;
                color: root.sort-field == "name" ? Style.sort-active : Style.sort-inactive;
            }
        }

        size-touch := TouchArea {
            width: 60px;
            clicked => {
                root.sort-changed("size");
            }
            Text {
                text: root.sort-field == "size" ? (root.sort-ascending ? "大小 ▲" : "大小 ▼") : "大小";
                vertical-alignment: center;
                horizontal-alignment: right;
                font-size: 12px;
                font-weight: root.sort-field == "size" ? 700 : 400;
                color: root.sort-field == "size" ? Style.sort-active : Style.sort-inactive;
            }
        }

        modified-touch := TouchArea {
            width: 110px;
            clicked => {
                root.sort-changed("modified");
            }
            Text {
                text: root.sort-field == "modified" ? (root.sort-ascending ? "修改时间 ▲" : "修改时间 ▼") : "修改时间";
                vertical-alignment: center;
                horizontal-alignment: right;
                font-size: 12px;
                font-weight: root.sort-field == "modified" ? 700 : 400;
                color: root.sort-field == "modified" ? Style.sort-active : Style.sort-inactive;
            }
        }
    }
}

export component FileItem inherits Rectangle {
    in property <FileEntry> entry;
    in property <bool> highlighted: false;
    callback clicked();
    callback clicked-with-modifiers(bool, bool);  // ctrl, shift
    callback double-clicked();
    height: 30px;
    border-radius: 3px;
    background: root.highlighted ? #e3f2fd : entry.selected ? Style.bg-selected : touch.has-hover ? Style.bg-hover : transparent;
    touch := TouchArea {
        clicked => {
            root.clicked();
        }
        double-clicked => {
            root.double-clicked();
        }
        pointer-event(event) => {
            if (event.kind == PointerEventKind.up && event.button == PointerEventButton.left) {
                if (event.modifiers.control || event.modifiers.shift) {
                    root.clicked-with-modifiers(event.modifiers.control, event.modifiers.shift);
                }
            }
        }
    }

    HorizontalLayout {
        padding-left: 8px;
        padding-right: 8px;
        spacing: 8px;

        // 图标
        Rectangle {
            width: 20px;
            Image {
                source: entry.is_dir ? @image-url("../assets/folder.svg") : @image-url("../assets/file.svg");
                width: 100%;
                height: 100%;
                vertical-alignment: center;
            }
        }
        
        // 文件名
        Text {
            text: entry.name;
            vertical-alignment: center;
            overflow: elide;
            horizontal-stretch: 1;
        }

        // 大小
        Text {
            text: entry.is_dir ? "" : entry.size;
            width: 60px;
            vertical-alignment: center;
            horizontal-alignment: right;
            color: Style.text-muted;
            font-size: 12px;
        }

        // 修改时间
        Text {
            text: entry.modified;
            width: 110px;
            vertical-alignment: center;
            horizontal-alignment: right;
            color: Style.text-muted;
            font-size: 12px;
        }
    }
}
