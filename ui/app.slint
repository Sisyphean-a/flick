import { Button, VerticalBox, ComboBox, LineEdit, ProgressBar, Text, HorizontalBox, GroupBox } from "std-widgets.slint";

export component AppWindow inherits Window {
    title: "Flick 文件传输";
    min-width: 450px;
    min-height: 350px;
    default-font-family: "Microsoft YaHei"; // 确保中文显示正常

    // 输入属性
    in property <string> file-path: "未选择文件";
    in property <float> progress: 0.0;
    in property <string> status-log: "等待操作...";
    in property <[string]> servers: ["本地测试服务器"];
    in property <bool> is-uploading: false;

    // 回调函数
    callback start-upload(int); // 参数：选中的服务器索引
    callback cancel-upload();

    VerticalBox {
        padding: 20px;
        spacing: 15px;

        Text {
            text: "Flick ⚡";
            font-size: 24px;
            font-weight: 700;
            horizontal-alignment: center;
        }

        GroupBox {
            title: "目标文件";
            Text {
                text: root.file-path;
                wrap: word-wrap;
                font-size: 14px;
                color: #555;
            }
        }

        HorizontalBox {
            spacing: 10px;
            Text {
                text: "选择服务器:";
                vertical-alignment: center;
            }
            ComboBox {
                model: root.servers;
                current-index: 0;
                width: 60%;
                enabled: !root.is-uploading;
            }
        }

        VerticalBox {
            spacing: 5px;
            Text {
                text: "传输进度: " + Math.round(root.progress * 100) + "%";
                font-size: 12px;
                color: #888;
            }
            ProgressBar {
                value: root.progress;
                height: 8px;
            }
        }

        Text {
            text: root.status-log;
            color: root.is-uploading ? #007bff : #666;
            horizontal-alignment: center;
        }

        HorizontalBox {
            alignment: center;
            Button {
                text: root.is-uploading ? "取消 (暂不支持)" : "开始传输";
                primary: true;
                width: 120px;
                height: 36px;
                enabled: !root.is-uploading; // 暂时禁用取消，因为 ssh2 阻塞
                clicked => {
                    if (!root.is-uploading) {
                        // ComboBox 的 current-index 无法直接传递给 callback? 
                        // 测试时发现可以，或者通过 property binding 传递
                        root.start-upload(0); // 暂时传0，需要在 Rust 端获取 index
                    }
                }
            }
        }
    }
}
