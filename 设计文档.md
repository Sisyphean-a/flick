### 📄 设计文档：Flick 架构与开发蓝图

#### 1. 系统架构图 (Architecture)

我们采用 **MVVM (Model-View-ViewModel)** 的变体，但更简化，分为 **Core (核心逻辑)**、**UI (界面交互)** 和 **Bridge (胶水层)**。

代码段

```
graph TD
    A[用户操作] -->|右键点击文件| B(CLI 入口: main.rs)
    B -->|解析文件路径| C{是否有配置文件?}
    C -->|否| D[弹出配置窗口]
    C -->|是| E[加载 Slint UI]
    E -->|UI 线程| F[显示服务器列表 & 进度条]
    E -->|Worker 线程| G[SSH 传输核心 (Core)]
    G -->|SFTP 协议| H[远程服务器]
    G -->|回调进度| F
    G -->|传输完成| I[自动关闭程序]
```

#### 2. 项目目录结构 (Directory Structure)

保持扁平化，但职责分明：

Plaintext

```
flick/
├── Cargo.toml          # 项目配置
├── build.rs            # Slint 编译脚本
├── ui/
│   └── app.slint       # UI 描述文件 (类似 CSS/HTML，但编译成 Rust)
├── src/
│   ├── main.rs         # 程序入口 (CLI解析, 启动 UI)
│   ├── config.rs       # 配置管理 (读取/保存 server.toml)
│   ├── ssh_core.rs     # SSH/SFTP 核心逻辑 (只做传输，不碰 UI)
│   └── utils.rs        # 工具函数 (注册表写入、路径处理)
└── install.bat         # (未来生成) 一键注册右键菜单脚本
```

#### 3. 模块功能设计

- **`main.rs` (大脑)**：

  - 负责检查启动参数。如果 `args` 里有文件路径，进入“传输模式”；如果没有参数，进入“设置模式”。
  - 初始化 Slint 窗口。

- **`ui/app.slint` (颜值)**：

  - 定义一个简单的窗口：包含一个文件名标签、一个下拉框（选择服务器）、一个进度条、一个“取消”按钮。
  - **关键设计**：使用 Slint 的原生控件，保证在 Windows 上看起来像原生应用。

- **`ssh_core.rs` (肌肉)**：

  - 封装 `ssh2::Session`。

  - 定义一个 `StandardUploader` 结构体。

  - **可扩展性设计**：定义一个 `Trait` (接口) 叫 `FileTransfer`。

    Rust

    ```
    pub trait FileTransfer {
        fn connect(&self) -> Result<()>;
        fn upload(&self, local_path: &Path, remote_path: &Path, callback: impl Fn(f32)) -> Result<()>;
    }
    ```

    *这样设计的好处是：未来如果你想支持 FTP、S3 或者是 WebDAV，只需要实现这个接口，UI 层不需要改任何代码。*

- **`config.rs` (记忆)**：

  - 使用 `serde` 序列化结构体。
  - 保存服务器列表（IP, Port, User, KeyPath/Password, DefaultTargetDir）。

#### 4. 开发方向与里程碑 (Roadmap)

- **阶段一：骨架搭建 (Skeleton)**
  - 完成 `ui/app.slint`，画出一个静态界面（进度条、文字）。
  - `main.rs` 跑通，能弹出一个窗口。
- **阶段二：数据联通 (Binding)**
  - 实现 Rust 代码控制 Slint 里的进度条从 0% 走到 100%。
  - 实现 `main.rs` 获取命令行参数，把文件名显示在 UI 上。
- **阶段三：核心功能 (Core Logic)**
  - 编写 `ssh_core.rs`，硬编码一个测试服务器信息。
  - 实现文件上传，并在回调函数里更新 UI 进度条。
- **阶段四：配置管理 (Configuration)**
  - 实现 `config.rs`，允许用户配置多个服务器。
  - UI 增加下拉框选择服务器。
- **阶段五：右键集成 (Integration)**
  - 编写注册表逻辑，让 `Flick` 出现在右键菜单。