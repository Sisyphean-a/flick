import { Button } from "std-widgets.slint";
import { FileEntry, FileItem } from "../components/file_item.slint";
import { PathBreadcrumb } from "../components/path_breadcrumb.slint";

export component LocalPanel inherits Rectangle {
    in property <string> current-path: "/";
    in property <[FileEntry]> files: [];

    callback navigate(string);
    callback go-up();
    callback file-clicked(int);
    callback file-double-clicked(int);
    callback refresh();

    border-width: 1px;
    border-color: #e0e0e0;
    border-radius: 4px;

    VerticalLayout {
        spacing: 0px;

        // æ ‡é¢˜æ 
        Rectangle {
            height: 32px;
            background: #f0f0f0;
            HorizontalLayout {
                padding-left: 10px;
                padding-right: 4px;
                Text {
                    text: "æœ¬åœ°æ–‡ä»¶";
                    font-weight: 600;
                    vertical-alignment: center;
                    horizontal-stretch: 1;
                }
                Button {
                    text: "ðŸ”„";
                    width: 28px;
                    clicked => { root.refresh(); }
                }
            }
        }

        // é¢åŒ…å±‘
        PathBreadcrumb {
            current-path: root.current-path;
            navigate(p) => { root.navigate(p); }
            go-up() => { root.go-up(); }
        }

        // æ–‡ä»¶åˆ—è¡¨
        Rectangle {
            clip: true;
            Flickable {
                x: 0px; y: 0px;
                width: 100%; height: 100%;
                viewport-height: root.files.length * 30px;
                VerticalLayout {
                    alignment: start;
                    for file[i] in root.files: FileItem {
                        entry: file;
                        clicked => { root.file-clicked(i); }
                        double-clicked => { root.file-double-clicked(i); }
                    }
                }
            }
        }
    }
}
