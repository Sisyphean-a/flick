import { Button } from "std-widgets.slint";
import { FileEntry, FileItem } from "../components/file_item.slint";
import { PathBreadcrumb } from "../components/path_breadcrumb.slint";
import { ServerSelector } from "../components/server_selector.slint";

export component RemotePanel inherits Rectangle {
    in property <string> current-path: "/";
    in property <[FileEntry]> files: [];
    in property <[string]> servers: [];
    in property <bool> connected: false;
    in property <bool> connecting: false;
    in property <string> status-text: "";

    callback connect(int);
    callback disconnect();
    callback navigate(string);
    callback go-up();
    callback file-clicked(int);
    callback file-double-clicked(int);
    callback refresh();
    callback select-all();
    callback mkdir(string);
    callback delete-selected();
    callback rename-item(int, string);

    border-width: 1px;
    border-color: #e0e0e0;
    border-radius: 4px;

    VerticalLayout {
        spacing: 0px;

        // æ ‡é¢˜æ 
        Rectangle {
            height: 32px;
            background: #f0f0f0;
            HorizontalLayout {
                padding-left: 10px;
                padding-right: 4px;
                Text {
                    text: "è¿œç¨‹æ–‡ä»¶";
                    font-weight: 600;
                    vertical-alignment: center;
                    horizontal-stretch: 1;
                }
                Button {
                    text: "ğŸ“+";
                    width: 36px;
                    enabled: root.connected;
                    clicked => { root.mkdir("æ–°å»ºç›®å½•"); }
                }
                Button {
                    text: "ğŸ—‘";
                    width: 28px;
                    enabled: root.connected;
                    clicked => { root.delete-selected(); }
                }
                Button {
                    text: "â˜‘";
                    width: 28px;
                    enabled: root.connected;
                    clicked => { root.select-all(); }
                }
                Button {
                    text: "ğŸ”„";
                    width: 28px;
                    enabled: root.connected;
                    clicked => { root.refresh(); }
                }
            }
        }

        // æœåŠ¡å™¨é€‰æ‹©
        ServerSelector {
            servers: root.servers;
            connected: root.connected;
            connecting: root.connecting;
            connect(idx) => { root.connect(idx); }
            disconnect() => { root.disconnect(); }
        }

        // é¢åŒ…å±‘ï¼ˆè¿æ¥åæ˜¾ç¤ºï¼‰
        if root.connected: PathBreadcrumb {
            current-path: root.current-path;
            navigate(p) => { root.navigate(p); }
            go-up() => { root.go-up(); }
        }

        // æ–‡ä»¶åˆ—è¡¨ / çŠ¶æ€æç¤º
        Rectangle {
            clip: true;

            if root.connected: Flickable {
                x: 0px; y: 0px;
                width: 100%; height: 100%;
                viewport-height: root.files.length * 30px;
                VerticalLayout {
                    alignment: start;
                    for file[i] in root.files: FileItem {
                        entry: file;
                        clicked => { root.file-clicked(i); }
                        double-clicked => {
                            root.file-double-clicked(i);
                        }
                    }
                }
            }

            if !root.connected: Text {
                text: root.connecting
                    ? "æ­£åœ¨è¿æ¥..."
                    : root.status-text != ""
                        ? root.status-text
                        : "è¯·é€‰æ‹©æœåŠ¡å™¨å¹¶è¿æ¥";
                horizontal-alignment: center;
                vertical-alignment: center;
                color: #999;
            }
        }
    }
}
